{% style %}
    :root {
        --background-header: {{ section.settings.background }}
    }
{% endstyle %}

<header 
    class="header"
    {%if section.settings.img_background != blank %}
        style="
            background-image: url('{{ section.settings.img_background | image_url: width: auto }}');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        "
    {% endif %}
>
    <div class="container">
        <nav class="header__wrapper">
            <div class="header-drawer">
                <div class="header-drawer__icon">
                    <button class="header-drawer__icon--close button-icon display-none">
                        {% render 'icon-close' %}
                    </button>
                    <button class="header-drawer__icon--humburger button-icon">
                        {% render 'icon-hamburger' %}
                    </button>
                </div>
                <ul class="header-drawer__list-menu">
                    {% for link in section.settings.menu.links %}
                        {% if link.url != blank %}
                            <li class="item">
                                <a href="{{ link.url | escape }}" class="item__link {% if link.current %} item__link--active {% endif %}">{{ link.title | escape }}</a>
                                {% if link.links != blank %}
                                    <ul class="sub-menu-mobile">
                                        {% for childlink in link.links %}
                                            <li class="sub-menu-mobile__item">
                                                <a href="{{ childlink.url }}" class="sub-menu-mobile__item--link">{{ childlink.title }}</a>
                                                {% if childlink.links != blank %}
                                                    <ul class="sub-menu-mobile">
                                                        {% for grandchildlink in childlink.links %}
                                                            <li class="sub-menu-mobile__item">
                                                                <a href="{{ grandchildlink.url }}" class="sub-menu__item--link">{{ grandchildlink.title }}</a>
                                                            </li>
                                                        {% endfor %}
                                                    </ul>
                                                {% endif %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
            <div class="header-heading">
                <a href="{{ routes.root_url }}" class="header-heading__link">
                    {% if settings.logo != blank %}
                        {{ settings.logo |  image_url: width: 600 | image_tag: 
                            width: settings.logo_width,
                            class: "header-heading__link--img"
                        }}
                    {% else %}
                    <h1 class="header-heading__link--text" style="font-size: {{settings.logo_text}}px">
                        {{ shop.name }}
                    </h1>
                    {% endif %}
                </a>
                <ul class="header-heading__list-menu">
                    {% for link in section.settings.menu.links %}
                        {% if link.url != blank %}
                            <li class="item">
                                <a href="{{ link.url | escape }}" class="item__link {% if link.current %} item__link--active {% endif %}">
                                    {{ link.title | escape }}{% if link.links != blank %}{% render 'icon-arrow-right' %}{% endif %}
                                </a>
                                {% if link.links != blank %}
                                    <ul class="sub-menu">
                                        {% for childlink in link.links %}
                                            <li class="sub-menu__item">
                                                <a href="{{ childlink.url }}" class="sub-menu__item--link">
                                                    {{ childlink.title }}{% if childlink.links != blank %}{% render 'icon-arrow-right' %}{% endif %}
                                                </a>
                                                {% if childlink.links != blank %}
                                                    <ul class="sub-menu">
                                                        {% for grandchildlink in childlink.links %}
                                                            <li class="sub-menu__item">
                                                                <a href="{{ grandchildlink.url }}" class="sub-menu__item--link">{{ grandchildlink.title }}</a>
                                                            </li>
                                                        {% endfor %}
                                                    </ul>
                                                {% endif %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
            <div class="header-task">
                {% if section.settings.show_search %}
                    <predictive-search class="header-task__wrapper">
                        <form action="{{ routes.search_url }}" method="get" role="search" class="header-task__search">
                            <button type="submit" class="header-task__search--button button-icon">
                                {% render 'icon-search' %}
                            </button>
                            <input
                                placeholder="Search something here!" 
                                class="header-task__search--input"
                                id="Search"
                                type="search"
                                name="q"
                                value="{{ search.terms | escape }}"
                                role="combobox"
                                aria-expanded="false"
                                aria-owns="predictive-search-results"
                                aria-controls="predictive-search-results"
                                aria-haspopup="listbox"
                                aria-autocomplete="list"
                            >
                            <input name="options[prefix]" type="hidden" value="last">
                            <div id="predictive-search" tabindex="-1"></div>
                        </form>
                    </predictive-search>
                {% endif %}

                {% if section.settings.show_button and section.settings.button_text != blank%}
                    <div class="header-task__button">
                        <a href="{{ section.settings.button_link | default: '#' }}" class="button button--secondary">{{ section.settings.button_text }}</a>
                    </div>
                {% endif %}

                {% if section.settings.show_currency %}
                    {% if localization.available_countries.size > 1 %}
                        <localization-form>
                          {% form 'localization' %}
                            <div class="header-task__disclosure">
                              <button type="button" class="header-task__disclosure--btn button-icon" aria-expanded="false" aria-controls="CountryList">
                                {% comment %} {% render 'icon-frame' %}  {% endcomment %}

                                <span class="flag-icon flag-icon-{{ localization.country.iso_code | downcase }} item__flag"></span>
                                <span class="disclosure-text">
                                    {% comment %} {{ localization.country.name }} ({{ localization.country.currency.iso_code }} {{ localization.country.currency.symbol }}) {% endcomment %}
                                    {{ localization.country.currency.iso_code }}
                                </span>
                                {% render 'icon-caret' %}
                              </button>
                      
                              <ul id="CountryList" role="list" class="header-task__disclosure--list">
                                {% for country in localization.available_countries %}
                                  <li class="item" tabindex="-1">
                                    <a href="#"{% if country.iso_code == localization.country.iso_code %} aria-current="true"{% endif %} data-value="{{ country.iso_code }}" class="item__link">
                                        <span class="flag-icon flag-icon-{{ country.iso_code | downcase }} item__flag"></span>
                                        <span class="tiem__name">
                                            {{ country.name }} ({{ country.currency.iso_code }} {{ country.currency.symbol }})
                                            </span>
                                        <span class="item__icon {% if country.iso_code != localization.country.iso_code %} visibility-hidden {% endif %}">
                                            {% render 'icon-checkmark' %}
                                        </span>
                                    </a>
                                  </li>
                                {% endfor %}
                              </ul>
                              <input type="hidden" name="country_code" value="{{ localization.country.iso_code }}">
                            </div>
                          {% endform %}
                        </localization-form>
                      {% endif %}
                {% endif %}
            </div>
            <div class="header-search">
                <button class="header-search__icon button-icon">{% render 'icon-search' %}</button>
                {% render 'header-search-modal' %}
            </div>
        </nav>
    </div>
</header>

{%  schema  %} 
    {
        "name": "Header",
        "class": "section-header",
        "settings":[
            {
                "type": "link_list",
                "id": "menu",
                "label": "Menu"
            },
            {
                "type": "header",
                "content": "Search"
            },
            {
                "type": "checkbox",
                "id": "show_search",
                "label": "Show search",
                "default": true
            },
            {
                "type": "header",
                "content": "Button"
            },
            {
                "type": "text",
                "id": "button_text",
                "default": "Join the community",
                "label": "Button text"
            },
            {
                "type": "url",
                "id": "button_link",
                "label": "Button link"
            },
            {
                "type": "checkbox",
                "id": "show_button",
                "label": "Show button",
                "default": true
            },
            {
                "type": "header",
                "content": "Currency"
            },
            {
                "type": "checkbox",
                "id": "show_currency",
                "label": "Show currency",
                "default": true
            },
            {
                "type": "color_background",
                "id": "background",
                "label": "Background",
                "default": "linear-gradient(102.87deg, #FCEED5 6.43%, #FCEED5 78.33%, #FFE7BA 104.24%)"
            },
            {
                "type": "image_picker",
                "id": "img_background",
                "label": "Background header",
            }
        ]
    }
{% endschema %}